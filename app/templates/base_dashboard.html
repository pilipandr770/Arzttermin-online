{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar" id="sidebar">
            <div class="position-sticky pt-3 px-3">
                <!-- User Info -->
                <div class="mb-4 pb-3 border-bottom">
                    <div class="d-flex align-items-center">
                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; font-size: 1.2rem;">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        <div class="ms-3">
                            <div class="fw-bold">{{ user_name if user_name else 'Benutzer' }}</div>
                            <small class="text-muted">{{ 'Patient' if user_type == 'patient' else 'Arzt' }}</small>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('patient_web.dashboard') if user_type == 'patient' else url_for('doctor_web.dashboard') }}"
                           data-voice-nav="nav-dashboard"
                           data-voice-title="Dashboard"
                           data-voice-description="Gehe zum Dashboard">
                            <i class="bi bi-house-door"></i> Dashboard
                        </a>
                    </li>
                    
                    {% if user_type == 'patient' %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('patient_web.search') }}"
                           data-voice-nav="nav-search"
                           data-voice-title="Arzt suchen"
                           data-voice-description="Gehe zur Arztsuche">
                            <i class="bi bi-search"></i> Arzt suchen
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('patient_web.calendar') }}"
                           data-voice-nav="nav-calendar"
                           data-voice-title="Termine finden"
                           data-voice-description="Zeige verfügbare Termine">
                            <i class="bi bi-calendar"></i> Termine finden
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('patient_web.bookings') }}"
                           data-voice-nav="nav-bookings"
                           data-voice-title="Meine Buchungen"
                           data-voice-description="Zeige meine gebuchten Termine">
                            <i class="bi bi-calendar-check"></i> Meine Buchungen
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('patient_web.profile') }}"
                           data-voice-nav="nav-profile"
                           data-voice-title="Patientenprofil"
                           data-voice-description="Bearbeite mein Profil">
                            <i class="bi bi-person"></i> Profil
                        </a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('doctor_web.calendar') }}"
                           data-voice-nav="nav-doctor-calendar"
                           data-voice-title="Kalender"
                           data-voice-description="Verwalte deinen Kalender">
                            <i class="bi bi-calendar"></i> Kalender
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('doctor_web.calendar_integrations') }}"
                           data-voice-nav="nav-doctor-integrations"
                           data-voice-title="Kalenderintegrationen"
                           data-voice-description="Integriere externe Kalender">
                            <i class="bi bi-calendar-plus"></i> Kalenderintegrationen
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('doctor_web.bookings') }}"
                           data-voice-nav="nav-doctor-bookings"
                           data-voice-title="Termine"
                           data-voice-description="Verwalte Patiententermine">
                            <i class="bi bi-calendar-check"></i> Termine
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('practice.practice_profile') }}"
                           data-voice-nav="nav-practice-profile"
                           data-voice-title="Praxisprofil"
                           data-voice-description="Bearbeite dein erweitertes Praxisprofil">
                            <i class="bi bi-hospital"></i> Erweiterte Praxis Profil
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('doctor_web.profile') }}"
                           data-voice-nav="nav-doctor-profile"
                           data-voice-title="Arztprofil"
                           data-voice-description="Bearbeite dein Profil">
                            <i class="bi bi-person"></i> Profil
                        </a>
                    </li>
                    {% endif %}
                    
                    <li class="nav-item mt-4 pt-3 border-top">
                        <a class="nav-link text-danger" href="#" onclick="logout()"
                           data-voice-nav="nav-logout"
                           data-voice-title="Abmelden"
                           data-voice-description="Melde dich ab">
                            <i class="bi bi-box-arrow-right"></i> Abmelden
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 fade-in">
            <!-- Page Header -->
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-4 pb-3 mb-4 border-bottom">
                <h1>{{ title }}</h1>
                <div class="btn-toolbar">
                    {% block toolbar %}{% endblock %}
                </div>
            </div>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages() %}
            {% if messages %}
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                {% for message in messages %}
                <p class="mb-0">{{ message }}</p>
                {% endfor %}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}
            {% endwith %}

            <!-- Main Content -->
            {% block dashboard_content %}{% endblock %}
        </main>
    </div>
</div>

<script>
function logout() {
    if (confirm('Möchten Sie sich wirklich abmelden?')) {
        localStorage.removeItem('access_token');
        localStorage.removeItem('user_type');
        window.location.href = '/';
    }
}

// Highlight active navigation link
document.addEventListener('DOMContentLoaded', function() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.sidebar .nav-link');
    
    navLinks.forEach(link => {
        if (link.getAttribute('href') === currentPath) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });
});
</script>
{% endblock %}

{% block scripts %}
{% block dashboard_scripts %}{% endblock %}
{% endblock %}